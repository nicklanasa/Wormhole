language: objective-c
install: ''
osx_image: xcode7.2

env:
  global:
    # Offset build number to prevent duplicate version errors from iTunes
    - TRAVIS_BUILD_NUMBER_OFFSET=150
		
before_install:
  # Reinstall Ruby to avoid SSL errors when publishing to iTunes
  - rvm reinstall 2.0.0-p643 --disable-binary
  - bundle install
  - ./ci/start_simulator.sh

before_script:
  - ./ci/tag_build.sh
  - ./ci/add_keys.sh

script:
  - ./ci/test_and_publish.sh

after_success:
  - ./ci/push_tag.sh
  - ./ci/send_release_email.rb
  - ./ci/generate_screenshots.sh

after_script:
  - ./ci/delete_keys.sh

# Don't build tags generated by CI, which are numeric
branches:
  except:
    - /^[0-9]*$/